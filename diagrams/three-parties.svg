<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1181px" preserveAspectRatio="none" style="width:1166px;height:1181px;background:#EEEEEE;" version="1.1" viewBox="0 0 1166 1181" width="1166px" zoomAndPan="magnify"><defs><filter height="300%" id="fiasp8c27ij4g" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="236" x="463.25" y="22.9951">Sprites Payments (Ideal Case)</text><rect fill="#EEEEEE" filter="url(#fiasp8c27ij4g)" height="226.5391" style="stroke: #000000; stroke-width: 2.0;" width="1128" x="6" y="737.25"/><rect fill="#EEEEEE" height="73.0703" style="stroke: none; stroke-width: 1.0;" width="1128" x="6" y="817.6484"/><rect fill="#EEEEEE" height="73.0703" style="stroke: none; stroke-width: 1.0;" width="1128" x="6" y="890.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="22" y1="116.5938" y2="1031.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="22" x2="22" y1="1031.0547" y2="1071.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="22" y1="1071.8594" y2="1169.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="95" x2="95" y1="116.5938" y2="1031.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="95" x2="95" y1="1031.0547" y2="1071.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="95" x2="95" y1="1071.8594" y2="1169.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="331" x2="331" y1="116.5938" y2="1031.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="331" x2="331" y1="1031.0547" y2="1071.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="331" x2="331" y1="1071.8594" y2="1169.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="436" x2="436" y1="116.5938" y2="1031.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="436" x2="436" y1="1031.0547" y2="1071.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="436" x2="436" y1="1071.8594" y2="1169.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="640" x2="640" y1="116.5938" y2="1031.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="640" x2="640" y1="1031.0547" y2="1071.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="640" x2="640" y1="1071.8594" y2="1169.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="803" x2="803" y1="116.5938" y2="1031.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="803" x2="803" y1="1031.0547" y2="1071.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="803" x2="803" y1="1071.8594" y2="1169.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1028" x2="1028" y1="116.5938" y2="1031.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1028" x2="1028" y1="1031.0547" y2="1071.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1028" x2="1028" y1="1071.8594" y2="1169.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1118" x2="1118" y1="116.5938" y2="1031.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1118" x2="1118" y1="1031.0547" y2="1071.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1118" x2="1118" y1="1071.8594" y2="1169.2578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="3" y="113.292">Alice</text><ellipse cx="22" cy="43.2969" fill="#0000FF" filter="url(#fiasp8c27ij4g)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M22,51.2969 L22,78.2969 M9,59.2969 L35,59.2969 M22,78.2969 L9,93.2969 M22,78.2969 L35,93.2969 " fill="none" filter="url(#fiasp8c27ij4g)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="51" y="113.292">Alice or Bob</text><ellipse cx="95" cy="43.2969" fill="#FEFECE" filter="url(#fiasp8c27ij4g)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M95,51.2969 L95,78.2969 M82,59.2969 L108,59.2969 M95,78.2969 L82,93.2969 M95,78.2969 L108,93.2969 " fill="none" filter="url(#fiasp8c27ij4g)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="314" y="113.292">Bob</text><ellipse cx="331" cy="43.2969" fill="#008000" filter="url(#fiasp8c27ij4g)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M331,51.2969 L331,78.2969 M318,59.2969 L344,59.2969 M331,78.2969 L318,93.2969 M331,78.2969 L344,93.2969 " fill="none" filter="url(#fiasp8c27ij4g)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="384.5" y="113.292">Bob or Charlie</text><ellipse cx="436" cy="43.2969" fill="#FEFECE" filter="url(#fiasp8c27ij4g)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M436,51.2969 L436,78.2969 M423,59.2969 L449,59.2969 M436,78.2969 L423,93.2969 M436,78.2969 L449,93.2969 " fill="none" filter="url(#fiasp8c27ij4g)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="613.5" y="113.292">Charlie</text><ellipse cx="640" cy="43.2969" fill="#FF0000" filter="url(#fiasp8c27ij4g)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M640,51.2969 L640,78.2969 M627,59.2969 L653,59.2969 M640,78.2969 L627,93.2969 M640,78.2969 L653,93.2969 " fill="none" filter="url(#fiasp8c27ij4g)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fiasp8c27ij4g)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="764.5" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="773" y="84.9951">Registry</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="771.5" y="101.292">Contract</text><rect fill="#FEFECE" filter="url(#fiasp8c27ij4g)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="989.5" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1004" y="84.9951">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="996.5" y="101.292">Contract</text><rect fill="#FEFECE" filter="url(#fiasp8c27ij4g)" height="62.8906" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="1076.5" y="48.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="1083.5" y="68.6982">Preimage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="1086" y="84.9951">Manager</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="1086.5" y="101.292">Contract</text><ellipse cx="21.5" cy="144.9766" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,141.7266,801,145.7266,791,149.7266,795,145.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="797" y1="145.7266" y2="145.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="29" y="140.6606">tx: createChannel(token, Bob)</text><polygon fill="#A80036" points="33,170.8594,23,174.8594,33,178.8594,29,174.8594" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="802.5" cy="174.1094" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="798" y1="174.8594" y2="174.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="39" y="169.7935">channelID: c1</text><ellipse cx="21.5" cy="203.2422" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="319,199.9922,329,203.9922,319,207.9922,323,203.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="325" y1="203.9922" y2="203.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="29" y="198.9263">channelID: c1</text><ellipse cx="330.5" cy="232.375" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,229.125,801,233.125,791,237.125,795,233.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="797" y1="233.125" y2="233.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="338" y="228.0591">tx: createChannel(token, Charlie)</text><polygon fill="#A80036" points="342,258.2578,332,262.2578,342,266.2578,338,262.2578" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="802.5" cy="261.5078" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="336" x2="798" y1="262.2578" y2="262.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="348" y="257.1919">channelID: c2</text><ellipse cx="330.5" cy="290.6406" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="628,287.3906,638,291.3906,628,295.3906,632,291.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="634" y1="291.3906" y2="291.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="338" y="286.3247">channelID: c1</text><ellipse cx="21.5" cy="319.7734" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="1016,316.5234,1026,320.5234,1016,324.5234,1020,320.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="1022" y1="320.5234" y2="320.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="29" y="315.4575">tx: approve(registry, amount)</text><ellipse cx="21.5" cy="348.9063" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,345.6563,801,349.6563,791,353.6563,795,349.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="797" y1="349.6563" y2="349.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="29" y="344.5903">tx: deposit(amount)</text><ellipse cx="802.5" cy="378.0391" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="1016,374.7891,1026,378.7891,1016,382.7891,1020,378.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="807" x2="1022" y1="378.7891" y2="378.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="810" y="373.7231">tx: transferFrom(Alice, amount)</text><ellipse cx="330.5" cy="407.1719" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="1016,403.9219,1026,407.9219,1016,411.9219,1020,407.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="1022" y1="407.9219" y2="407.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="338" y="402.856">tx: approve(registry, amount)</text><ellipse cx="330.5" cy="436.3047" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,433.0547,801,437.0547,791,441.0547,795,437.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="797" y1="437.0547" y2="437.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="338" y="431.9888">tx: deposit(amount)</text><ellipse cx="802.5" cy="465.4375" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="1016,462.1875,1026,466.1875,1016,470.1875,1020,466.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="807" x2="1022" y1="466.1875" y2="466.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="810" y="461.1216">tx: transferFrom(Bob, amount)</text><ellipse cx="21.5" cy="494.5703" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="628,491.3203,638,495.3203,628,499.3203,632,495.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="634" y1="495.3203" y2="495.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="29" y="490.2544">msg: preimage</text><ellipse cx="21.5" cy="523.7031" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="319,520.4531,329,524.4531,319,528.4531,323,524.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="325" y1="524.4531" y2="524.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="29" y="519.3872">msg: openPayment: amount, preimageHash</text><ellipse cx="330.5" cy="552.8359" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,549.5859,801,553.5859,791,557.5859,795,553.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="797" y1="553.5859" y2="553.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="338" y="548.52">call: channelState(c1)</text><ellipse cx="330.5" cy="581.9688" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="373" y1="582.7188" y2="582.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="373" x2="373" y1="582.7188" y2="595.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="332" x2="373" y1="595.7188" y2="595.7188"/><polygon fill="#A80036" points="342,591.7188,332,595.7188,342,599.7188,338,595.7188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="338" y="577.6528">verifyPayment</text><ellipse cx="330.5" cy="624.1016" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="628,620.8516,638,624.8516,628,628.8516,632,624.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="634" y1="624.8516" y2="624.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="338" y="619.7856">msg: openPayment: amount, preimageHash</text><ellipse cx="639.5" cy="653.2344" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,649.9844,801,653.9844,791,657.9844,795,653.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="644" x2="797" y1="653.9844" y2="653.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="647" y="648.9185">call: channelState(c2)</text><ellipse cx="639.5" cy="682.3672" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="644" x2="682" y1="683.1172" y2="683.1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="682" x2="682" y1="683.1172" y2="696.1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="641" x2="682" y1="696.1172" y2="696.1172"/><polygon fill="#A80036" points="651,692.1172,641,696.1172,651,700.1172,647,696.1172" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="647" y="678.0513">verifyPayment</text><polygon fill="#A80036" points="342,721.25,332,725.25,342,729.25,338,725.25" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="639.5" cy="724.5" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="336" x2="635" y1="725.25" y2="725.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="348" y="720.1841">msg: publish preimage</text><polygon fill="#A80036" points="33,721.25,23,725.25,33,729.25,29,725.25" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="639.5" cy="724.5" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="635" y1="725.25" y2="725.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="39" y="720.1841">...</text><path d="M6,737.25 L70,737.25 L70,744.25 L60,754.25 L6,754.25 L6,737.25 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="226.5391" style="stroke: #000000; stroke-width: 2.0;" width="1128" x="6" y="737.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="21" y="750.3169">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="85" y="749.4604">[ideal case]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="6" x2="1134" y1="818.6484" y2="818.6484"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="11" y="828.8589">[Alice does not complete]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="6" x2="1134" y1="891.7188" y2="891.7188"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="11" y="901.9292">[Bob does not complete]</text><ellipse cx="21.5" cy="779.7656" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="319,776.5156,329,780.5156,319,784.5156,323,780.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="325" y1="780.5156" y2="780.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="29" y="775.4497">msg: completePayment: channelState</text><ellipse cx="330.5" cy="808.8984" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="628,805.6484,638,809.6484,628,813.6484,632,809.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="634" y1="809.6484" y2="809.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="338" y="804.5825">msg: completePayment: channelState</text><ellipse cx="330.5" cy="852.8359" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="628,849.5859,638,853.5859,628,857.5859,632,853.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="634" y1="853.5859" y2="853.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="338" y="848.52">msg: completePayment: channelState</text><ellipse cx="330.5" cy="881.9688" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="1106,878.7188,1116,882.7188,1106,886.7188,1110,882.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="1112" y1="882.7188" y2="882.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="338" y="877.6528">tx: submitPreimage: preimage</text><ellipse cx="21.5" cy="925.9063" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="319,922.6563,329,926.6563,319,930.6563,323,926.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="325" y1="926.6563" y2="926.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="29" y="921.5903">msg: completePayment: channelState</text><ellipse cx="639.5" cy="955.0391" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="1106,951.7891,1116,955.7891,1106,959.7891,1110,955.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="644" x2="1112" y1="955.7891" y2="955.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="647" y="950.7231">tx: submitPreimage(preimage)</text><ellipse cx="94.5" cy="993.1719" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,989.9219,801,993.9219,791,997.9219,795,993.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="797" y1="993.9219" y2="993.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="102" y="988.856">tx: update(c1, channelState)</text><ellipse cx="435.5" cy="993.1719" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,989.9219,801,993.9219,791,997.9219,795,993.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="797" y1="993.9219" y2="993.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="443" y="988.856">tx: update(c2, channelState)</text><ellipse cx="94.5" cy="1022.3047" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,1019.0547,801,1023.0547,791,1027.0547,795,1023.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="797" y1="1023.0547" y2="1023.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="102" y="1017.9888">tx: trigger(c1)</text><ellipse cx="435.5" cy="1022.3047" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,1019.0547,801,1023.0547,791,1027.0547,795,1023.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="797" y1="1023.0547" y2="1023.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="443" y="1017.9888">tx: trigger(c2)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="306" x="419" y="1055.2651">Δ later for each channel with respective call to trigger</text><ellipse cx="94.5" cy="1092.2422" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,1088.9922,801,1092.9922,791,1096.9922,795,1092.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="797" y1="1092.9922" y2="1092.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="102" y="1087.9263">tx: finalize(c1)</text><ellipse cx="435.5" cy="1092.2422" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,1088.9922,801,1092.9922,791,1096.9922,795,1092.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="797" y1="1092.9922" y2="1092.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="443" y="1087.9263">tx: finalize(c2)</text><ellipse cx="802.5" cy="1121.375" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="1106,1118.125,1116,1122.125,1106,1126.125,1110,1122.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="807" x2="1112" y1="1122.125" y2="1122.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="810" y="1117.0591">call: revealedBefore(hash, expiry)</text><ellipse cx="94.5" cy="1150.5078" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,1147.2578,801,1151.2578,791,1155.2578,795,1151.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="797" y1="1151.2578" y2="1151.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="102" y="1146.1919">tx: withdraw(c1)</text><ellipse cx="435.5" cy="1150.5078" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="791,1147.2578,801,1151.2578,791,1155.2578,795,1151.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="440" x2="797" y1="1151.2578" y2="1151.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="443" y="1146.1919">tx: withdraw(c2)</text><!--
@startuml
!pragma teoz true

skinparam backgroundColor #EEEEEE
hide footbox
actor Alice #blue
actor c1 as "Alice or Bob"
actor Bob #green
actor c2 as "Bob or Charlie"
actor Charlie #red
participant Registry as "Registry\nContract"
participant Token as "Token\nContract"
participant PM as "Preimage\nManager\nContract"

title : Sprites Payments (Ideal Case)

Alice    o-> Registry: tx: createChannel(token, Bob)
Registry o-> Alice: channelID: c1
Alice    o-> Bob: channelID: c1

Bob      o-> Registry: tx: createChannel(token, Charlie)
Registry o-> Bob: channelID: c2
Bob      o-> Charlie: channelID: c1

Alice    o-> Token: tx: approve(registry, amount)
Alice    o-> Registry: tx: deposit(amount)
Registry o-> Token: tx: transferFrom(Alice, amount)

Bob      o-> Token: tx: approve(registry, amount)
Bob      o-> Registry: tx: deposit(amount)
Registry o-> Token: tx: transferFrom(Bob, amount)

Alice    o-> Charlie: msg: preimage

Alice    o-> Bob: msg: openPayment: amount, preimageHash

Bob      o-> Registry: call: channelState(c1)
Bob      o-> Bob: verifyPayment
Bob      o-> Charlie: msg: openPayment: amount, preimageHash

Charlie  o-> Registry: call: channelState(c2)
Charlie  o-> Charlie: verifyPayment

Bob <-o Charlie: msg: publish preimage
& Alice <-o Charlie: ...

alt ideal case
    Alice   o-> Bob: msg: completePayment: channelState
    Bob     o-> Charlie: msg: completePayment: channelState
else Alice does not complete
    Bob     o-> Charlie: msg: completePayment: channelState
    Bob o-> PM: tx: submitPreimage: preimage
else Bob does not complete
    Alice o-> Bob: msg: completePayment: channelState
    Charlie o-> PM: tx: submitPreimage(preimage)
end

c1 o-> Registry: tx: update(c1, channelState)
& c2 o-> Registry: tx: update(c2, channelState)

c1 o-> Registry: tx: trigger(c1)
& c2 o-> Registry: tx: trigger(c2)

... Δ later for each channel with respective call to trigger...

c1 o-> Registry: tx: finalize(c1)
& c2 o-> Registry: tx: finalize(c2)

Registry o-> PM: call: revealedBefore(hash, expiry)

c1 o-> Registry: tx: withdraw(c1)
& c2 o-> Registry: tx: withdraw(c2)

@enduml

PlantUML version 1.2018.02(Sat Mar 10 01:20:44 HKT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_162-b12
Operating System: Linux
OS Version: 4.15.14-1-ARCH
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>