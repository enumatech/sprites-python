<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="660px" preserveAspectRatio="none" style="width:803px;height:660px;background:#EEEEEE;" version="1.1" viewBox="0 0 803 660" width="803px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ae37rq595c9x" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="213" x="293" y="22.9951">Sprites Payments 2 Parties</text><rect fill="#EEEEEE" filter="url(#f1ae37rq595c9x)" height="95.2031" style="stroke: #000000; stroke-width: 2.0;" width="764.5" x="6" y="332.5234"/><rect fill="#EEEEEE" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="764.5" x="6" y="383.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="22" y1="116.5938" y2="510.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="22" x2="22" y1="510.125" y2="550.9297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="22" y1="550.9297" y2="648.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="353" x2="353" y1="116.5938" y2="510.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="353" x2="353" y1="510.125" y2="550.9297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="353" x2="353" y1="550.9297" y2="648.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418.5" x2="418.5" y1="116.5938" y2="510.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="418.5" x2="418.5" y1="510.125" y2="550.9297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418.5" x2="418.5" y1="550.9297" y2="648.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="664.5" x2="664.5" y1="116.5938" y2="510.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="664.5" x2="664.5" y1="510.125" y2="550.9297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="664.5" x2="664.5" y1="550.9297" y2="648.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="754.5" x2="754.5" y1="116.5938" y2="510.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="754.5" x2="754.5" y1="510.125" y2="550.9297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="754.5" x2="754.5" y1="550.9297" y2="648.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="3" y="113.292">Alice</text><ellipse cx="22" cy="43.2969" fill="#0000FF" filter="url(#f1ae37rq595c9x)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M22,51.2969 L22,78.2969 M9,59.2969 L35,59.2969 M22,78.2969 L9,93.2969 M22,78.2969 L35,93.2969 " fill="none" filter="url(#f1ae37rq595c9x)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="336" y="113.292">Bob</text><ellipse cx="353" cy="43.2969" fill="#008000" filter="url(#f1ae37rq595c9x)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M353,51.2969 L353,78.2969 M340,59.2969 L366,59.2969 M353,78.2969 L340,93.2969 M353,78.2969 L366,93.2969 " fill="none" filter="url(#f1ae37rq595c9x)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1ae37rq595c9x)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="380" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="388.5" y="84.9951">Registry</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="387" y="101.292">Contract</text><rect fill="#FEFECE" filter="url(#f1ae37rq595c9x)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="626" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="640.5" y="84.9951">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="633" y="101.292">Contract</text><rect fill="#FEFECE" filter="url(#f1ae37rq595c9x)" height="62.8906" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="713" y="48.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="720" y="68.6982">Preimage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="722.5" y="84.9951">Manager</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="723" y="101.292">Contract</text><polygon fill="#A80036" points="406.5,141.7266,416.5,145.7266,406.5,149.7266,410.5,145.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="412.5" y1="145.7266" y2="145.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="140.6606">01</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="51" y="140.6606">tx: createChannel(token, Bob)</text><polygon fill="#A80036" points="33,170.8594,23,174.8594,33,178.8594,29,174.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="417.5" y1="174.8594" y2="174.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="39" y="169.7935">02</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="61" y="169.7935">receipt: channelID: c1</text><polygon fill="#A80036" points="652.5,199.9922,662.5,203.9922,652.5,207.9922,656.5,203.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="658.5" y1="203.9922" y2="203.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="198.9263">03</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="51" y="198.9263">tx: approve(registry, amount)</text><polygon fill="#A80036" points="406.5,229.125,416.5,233.125,406.5,237.125,410.5,233.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="412.5" y1="233.125" y2="233.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="228.0591">04</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="51" y="228.0591">tx: deposit(amount)</text><polygon fill="#A80036" points="652.5,258.2578,662.5,262.2578,652.5,266.2578,656.5,262.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418.5" x2="658.5" y1="262.2578" y2="262.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="425.5" y="257.1919">05</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="447.5" y="257.1919">tx: transferFrom(alice, amount)</text><polygon fill="#A80036" points="341,287.3906,351,291.3906,341,295.3906,345,291.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="347" y1="291.3906" y2="291.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="286.3247">06</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="51" y="286.3247">msg: openPayment: amount, preimageHash</text><polygon fill="#A80036" points="341,316.5234,351,320.5234,341,324.5234,345,320.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="347" y1="320.5234" y2="320.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="315.4575">07</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="51" y="315.4575">msg: preimage</text><path d="M6,332.5234 L70,332.5234 L70,339.5234 L60,349.5234 L6,349.5234 L6,332.5234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="95.2031" style="stroke: #000000; stroke-width: 2.0;" width="764.5" x="6" y="332.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="21" y="345.5903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="85" y="344.7339">[ideal case]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="6" x2="770.5" y1="384.7891" y2="384.7891"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="11" y="394.9995">[Alice does not complete]</text><polygon fill="#A80036" points="341,371.7891,351,375.7891,341,379.7891,345,375.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="22" x2="347" y1="375.7891" y2="375.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="370.7231">08</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="51" y="370.7231">msg: completePayment: channelState</text><polygon fill="#A80036" points="742.5,415.7266,752.5,419.7266,742.5,423.7266,746.5,419.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="353" x2="748.5" y1="419.7266" y2="419.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="360" y="414.6606">09</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="382" y="414.6606">tx: submitPreimage: preimage</text><ellipse cx="21.5" cy="472.2422" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="406.5,468.9922,416.5,472.9922,406.5,476.9922,410.5,472.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="26" x2="412.5" y1="472.9922" y2="472.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="460.3599">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="51" y="452.7935">tx: update(round, credits, withdrawals,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="123" y="467.9263">hash, expiry, amount)</text><ellipse cx="352.5" cy="472.2422" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="406.5,468.9922,416.5,472.9922,406.5,476.9922,410.5,472.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="357" x2="412.5" y1="472.9922" y2="472.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="360" y="460.3599">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="382" y="452.7935">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="382" y="467.9263">...</text><ellipse cx="21.5" cy="501.375" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="406.5,498.125,416.5,502.125,406.5,506.125,410.5,502.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="26" x2="412.5" y1="502.125" y2="502.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="497.0591">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="51" y="497.0591">tx: trigger</text><ellipse cx="352.5" cy="501.375" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="406.5,498.125,416.5,502.125,406.5,506.125,410.5,502.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="357" x2="412.5" y1="502.125" y2="502.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="360" y="497.0591">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="382" y="497.0591">...</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="37" x="371.75" y="534.3354">Δ later</text><ellipse cx="21.5" cy="571.3125" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="406.5,568.0625,416.5,572.0625,406.5,576.0625,410.5,572.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="26" x2="412.5" y1="572.0625" y2="572.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="566.9966">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="51" y="566.9966">tx: finalize</text><ellipse cx="352.5" cy="571.3125" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="406.5,568.0625,416.5,572.0625,406.5,576.0625,410.5,572.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="357" x2="412.5" y1="572.0625" y2="572.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="360" y="566.9966">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="382" y="566.9966">...</text><polygon fill="#A80036" points="742.5,597.1953,752.5,601.1953,742.5,605.1953,746.5,601.1953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418.5" x2="748.5" y1="601.1953" y2="601.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="425.5" y="596.1294">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="447.5" y="596.1294">call: revealedBefore(hash, expiry)</text><ellipse cx="21.5" cy="629.5781" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="406.5,626.3281,416.5,630.3281,406.5,634.3281,410.5,630.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="26" x2="412.5" y1="630.3281" y2="630.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="29" y="625.2622">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="51" y="625.2622">tx: withdraw</text><!--
@startuml
!pragma teoz true

skinparam backgroundColor #EEEEEE
hide footbox
autonumber "<b>00"
actor Alice #blue
actor Bob #green
participant Registry as "Registry\nContract"
participant Token as "Token\nContract"
participant PM as "Preimage\nManager\nContract"

title : Sprites Payments 2 Parties

Alice   -> Registry: tx: createChannel(token, Bob)
Registry -> Alice: receipt: channelID: c1

Alice -> Token: tx: approve(registry, amount)
Alice -> Registry: tx: deposit(amount)
Registry -> Token: tx: transferFrom(alice, amount)

Alice   -> Bob: msg: openPayment: amount, preimageHash
Alice   -> Bob: msg: preimage

alt ideal case
    Alice   -> Bob: msg: completePayment: channelState
else Alice does not complete
    Bob -> PM: tx: submitPreimage: preimage
end

Alice o- -> Registry: tx: update(round, credits, withdrawals, \n                  hash, expiry, amount)

& Bob o- -> Registry:  ... \n...

Alice o- -> Registry: tx: trigger

& Bob o- -> Registry:  ...

... Δ later...

Alice o- -> Registry: tx: finalize
& Bob o- -> Registry:  ...

Registry -> PM: call: revealedBefore(hash, expiry)

Alice o- -> Registry: tx: withdraw

@enduml

PlantUML version 1.2018.02(Sat Mar 10 01:20:44 HKT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_162-b12
Operating System: Linux
OS Version: 4.15.14-1-ARCH
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>